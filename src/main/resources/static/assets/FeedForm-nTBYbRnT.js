import{_ as V,r,h as B,c as y,a as o,w as h,g as b,e as x,I as A,v as E,H as L,F as N,f as q,y as D,u as H,o as g,t as U}from"./index-COm22Z05.js";const $={class:"container-fluid py-4"},j={class:"row justify-content-center"},R={class:"col-lg-8 col-md-10"},z={class:"form-container p-4 bg-white shadow rounded"},W={class:"mb-3"},P={key:0,class:"mt-2"},O={class:"mb-3"},Q=["value"],G={class:"content-container"},J={key:0,class:"content-placeholder"},K={class:"mt-3"},X={__name:"FeedForm",setup(Y){const w=H(),d=r(!1),c=r(""),p=r(""),v=r(""),F=r(""),C=["자유","자격증","문제","기술","취업","Q/A","자료"],f=r(!0),i=r(null),k=r([]);r([]);function _(){w.push("/search/view/feed/vote")}function I(){f.value=i.value.innerText.trim()===""}function T(){f.value=i.value.innerText.trim()==="",F.value=i.value.innerHTML}function M(s){const e=Array.from(s.target.files);k.value.push(...e),e.forEach(t=>{const u=new FileReader;u.onload=l=>{const m=document.createElement("img");m.src=l.target.result,m.style.maxWidth="100%",m.style.margin="10px 0",m.style.display="block";const a=document.createElement("div");a.className="image-wrapper",a.contentEditable=!1,a.style.position="relative",a.style.display="inline-block",a.style.resize="both",a.style.overflow="auto",a.appendChild(m);const n=document.createElement("button");n.innerHTML="&times;",n.style.position="absolute",n.style.top="5px",n.style.right="5px",n.style.background="red",n.style.color="white",n.style.border="none",n.style.borderRadius="50%",n.style.width="25px",n.style.height="25px",n.style.cursor="pointer",n.onclick=()=>a.remove(),a.appendChild(n),i.value.appendChild(a),i.value.appendChild(document.createElement("br"))},u.readAsDataURL(t)})}async function S(){if(!p.value||!v.value||!i.value.innerText.trim()){alert("모든 필드를 입력해주세요");return}const s=new FormData,e=i.value.cloneNode(!0);e.querySelectorAll(".image-wrapper").forEach(t=>{const u=t.querySelector("img");if(u){const l=document.createElement("img");l.src=u.src,l.width=t.offsetWidth,l.height=t.offsetHeight,l.style.maxWidth="100%",t.parentNode.replaceChild(l,t)}}),s.append("title",v.value),s.append("category",p.value),s.append("description",e.innerHTML),s.append("username",d.value?c.value:c.value.trim()),k.value.forEach(t=>s.append("imageFiles",t));try{const t=localStorage.getItem("token"),l=await(await fetch("/api/search/view/feed/save",{method:"POST",body:s,headers:{Authorization:`Bearer ${t}`}})).json();if(console.log(l),l.success)alert("게시글이 성공적으로 작성되셨습니다."),w.push("/");else throw new Error(l.error||"등록 실패")}catch(t){console.error(t),alert("작성 실패")}}return B(async()=>{const s=localStorage.getItem("token");if(s)try{const t=await(await fetch("/api/auth/status",{headers:{Authorization:`Bearer ${s}`}})).json();t.isLoggedIn&&(d.value||(c.value=t.username))}catch(e){console.error("유저 정보 불러오기 실패:",e)}}),(s,e)=>(g(),y("div",$,[o("form",{onSubmit:D(S,["prevent"]),enctype:"multipart/form-data"},[o("div",j,[o("div",R,[o("div",z,[o("h3",{class:"mb-3 d-flex justify-content-between"},[e[6]||(e[6]=b(" 글쓰기 ")),o("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_},"+ 투표 작성하기")]),o("div",W,[h(o("input",{type:"checkbox",id:"anonymous","onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t)},null,512),[[A,d.value]]),e[7]||(e[7]=o("label",{for:"anonymous"},"익명으로 작성하기",-1)),d.value?(g(),y("div",P,[h(o("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),placeholder:"이름을 입력하세요",required:""},null,512),[[E,c.value]])])):x("",!0)]),o("div",O,[h(o("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),class:"form-select",required:""},[e[8]||(e[8]=o("option",{disabled:"",value:""},"게시판을 선택해 주세요",-1)),(g(),y(N,null,q(C,t=>o("option",{key:t,value:t},U(t),9,Q)),64))],512),[[L,p.value]])]),h(o("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),class:"form-control mb-3 title-input",placeholder:"제목을 입력해 주세요",required:""},null,512),[[E,v.value]]),o("div",G,[f.value?(g(),y("div",J,"내용을 입력하세요.")):x("",!0),o("div",{class:"content-editor",contenteditable:"true",ref_key:"editor",ref:i,onInput:T,onFocus:e[4]||(e[4]=t=>f.value=!1),onBlur:I},null,544)]),o("div",K,[e[10]||(e[10]=o("label",{class:"form-label"},"이미지 파일 업로드",-1)),o("div",{class:"image-upload-container",onClick:e[5]||(e[5]=t=>s.$refs.imageInput.click())},[e[9]||(e[9]=o("label",null,[o("i",{class:"fas fa-upload"}),b(" 클릭하여 사진을 업로드하세요")],-1)),o("input",{ref:"imageInput",type:"file",class:"d-none",accept:"image/*",multiple:"",onChange:M},null,544)])]),e[11]||(e[11]=o("button",{type:"submit",class:"btn btn-success mt-4"},[o("i",{class:"fas fa-pen"}),b(" 작성하기 ")],-1))])])])],32)]))}},ee=V(X,[["__scopeId","data-v-8d58db9d"]]);export{ee as default};
