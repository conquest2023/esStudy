import{_ as ee,J as te,q as se,r as o,d as U,h as ne,m as d,K as ae,u as oe,c as i,e as y,a as e,g as b,t as l,n as le,F as V,f as H,w as I,E as ie,v as R,o as r,p as re}from"./index-COm22Z05.js";const ce={key:0,class:"container my-4 pt-navbar"},ue={key:0,class:"text-end mb-2"},de={class:"card shadow-sm feed-card"},me={class:"card-body"},ve={class:"feed-title"},pe={class:"feed-meta"},fe=["innerHTML"],be={class:"feed-actions d-flex justify-content-between align-items-center mt-3 position-relative"},he={class:"text-muted"},ge={class:"ms-1"},we={key:1,class:"text-muted"},ye={class:"comment-body flex-grow-1"},_e={class:"d-flex justify-content-between"},ke={class:"meta"},xe={class:"ms-2 text-muted"},De={key:0},Ce=["onClick"],$e=["innerHTML"],Ue={key:0,class:"mt-2"},Ie={class:"text-muted ms-2"},Te=["onClick"],Me={class:"mt-2"},Oe=["onUpdate:modelValue"],Se=["onClick"],Le={class:"card shadow-sm p-3 mt-4"},Ne={class:"mb-3 d-flex justify-content-between align-items-center"},Ve=["placeholder"],He=["disabled"],Re={key:1,class:"text-center pt-5"},Be={__name:"FeedDetail",setup(Fe){const B=se(),v=oe(),F=te(),{push:p}=ae(),c=B.params.id,m=o({}),T=o(""),u=o([]),_=o(0),h=o(!1),M=o(!1),g=o({}),J=o(""),k=o({}),x=o(null),f=o(""),C=o(!1),O=o(0),w=U(()=>!!F.token),j=U(()=>{var s;return((s=m.value)==null?void 0:s.Owner)===!0});function A(s=""){const t=/(https?:\/\/[^\s]+)/g;return s.replace(t,n=>`<a href="${n}" target="_blank">${n}</a>`)}ne(async()=>{try{const{data:s}=await d.get("/detail",{params:{id:c}});m.value={...s.data,Owner:s.Owner},T.value=P(s.data.description||"").replace(/\n/g,"<br>"),u.value=s.comment||[],g.value=s.replies||{},h.value=s.isLiked,_.value=s.data.likeCount||0,M.value=!0,fetch("/api/increaseViewCount",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:c})}).catch(t=>console.error("조회수 증가 실패",t))}catch{p("게시글을 불러오지 못했습니다."),v.replace("/")}});function P(s=""){return s.replace(/(https?:\/\/[^\s<]+)/g,'<a href="$1" target="_blank">$1</a>')}function q(s){if(!s)return"";const t=new Date(s),n=t.getMonth()+1,a=t.getDate();let D=t.getHours();const $=t.getMinutes(),Y=D>=12?"오후":"오전";D=D%12||12;const Z=$<10?`0${$}`:$;return`${n}. ${a}. ${Y} ${D}:${Z}`}const z=U(()=>q(m.value.createdAt)),E=JSON.parse(localStorage.getItem("topWriters")||"{}");function S(s){const t=E[s]||0;return t===1?"👑":t===2?"🥇":t===3?"🥈":t>0&&t<=5?"🥉":""}async function W(){if(!w.value){p("로그인이 필요합니다");return}const s=h.value;h.value=!s,_.value+=s?-1:1;try{await d.post(s?`/search/view/feed/cancel-like/${c}`:`/search/view/feed/increase-like/${c}`)}catch{h.value=s,_.value+=s?1:-1}}async function K(){if(!f.value.trim()){alert("댓글 내용을 입력하세요!");return}const s=localStorage.getItem("token");if(!s){alert("로그인이 필요합니다."),v.push("/login");return}C.value=!0;try{await d.post(`/search/view/comment/id?feedUID=${c}`,{content:f.value},{headers:{Authorization:`Bearer ${s}`}}),await new Promise(n=>setTimeout(n,1e3));const{data:t}=await d.get("/detail",{params:{id:c}});u.value=t.comment||[],f.value=""}catch(t){console.error(t),alert("댓글 저장 중 오류 발생")}finally{C.value=!1}}function L(){v.push({path:"/search/view/feed/update",query:{id:m.value.feedUID}})}async function N(){if(confirm("정말로 이 게시글을 삭제하시겠습니까?"))try{await d.post("/search/view/feed/delete",{id:m.value.id}),p("게시글이 삭제되었습니다"),await new Promise(s=>setTimeout(s,1e3)),v.push("/")}catch{p("삭제 중 오류 발생")}}async function G(s){confirm("삭제할까요?")&&(await d.post("/search/view/comment/delete",null,{params:{id:s.commentUID,feedUID:c}}),u.value=u.value.filter(t=>t.commentUID!==s.commentUID))}function Q(s){x.value=x.value===s?null:s,J.value=""}async function X(s){const t=k.value[s]||"";if(!w.value){p("로그인이 필요합니다"),v.push("/login");return}if(!t.trim()){alert("답글 내용을 입력하세요.");return}try{await d.post("/search/view/reply/save",{commentUID:s,feedUID:c,content:t}),await new Promise(a=>setTimeout(a,1e3));const{data:n}=await d.get("/detail",{params:{id:c}});u.value=n.comment||[],g.value=JSON.parse(JSON.stringify(n.replies)),x.value=null,k.value[s]="",O.value++}catch(n){console.error(n),p("답글 저장 실패")}}return(s,t)=>M.value?(r(),i("section",ce,[j.value?(r(),i("div",ue,[e("div",{class:"dropdown d-none d-md-inline"},[t[4]||(t[4]=e("button",{class:"btn btn-outline-secondary","data-bs-toggle":"dropdown"},[e("i",{class:"fas fa-ellipsis-v"})],-1)),e("ul",{class:"dropdown-menu dropdown-menu-end"},[e("li",null,[e("a",{class:"dropdown-item",onClick:L},t[2]||(t[2]=[e("i",{class:"fas fa-edit me-2"},null,-1),b("수정 ")]))]),e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:N},t[3]||(t[3]=[e("i",{class:"fas fa-trash me-2"},null,-1),b("삭제 ")]))])])]),t[5]||(t[5]=e("button",{class:"btn btn-primary rounded-circle shadow d-md-none position-fixed",style:{bottom:"80px",right:"24px",width:"56px",height:"56px"},"data-bs-toggle":"dropdown","data-bs-target":"#fabMenu"},[e("i",{class:"fas fa-ellipsis-v"})],-1)),e("ul",{class:"dropdown-menu dropdown-menu-end",id:"fabMenu"},[e("li",null,[e("a",{class:"dropdown-item",onClick:L},"수정")]),e("li",null,[e("a",{class:"dropdown-item text-danger",onClick:N},"삭제")])])])):y("",!0),e("div",de,[e("div",me,[e("h2",ve,l(m.value.title),1),e("p",pe,[t[6]||(t[6]=e("strong",null,"작성자:",-1)),b(" "+l(s.badge)+" "+l(m.value.username)+" · ",1),e("span",null,l(z.value),1)]),e("div",{class:"feed-content",innerHTML:T.value},null,8,fe),e("div",be,[e("span",he,[t[7]||(t[7]=e("i",{class:"bi bi-chat-dots"},null,-1)),b(" "+l(u.value.length),1)]),e("button",{class:"btn btn-sm btn-outline-danger like-btn position-relative",onClick:W},[e("i",{class:le(["bi",h.value?"bi-heart-fill":"bi-heart"])},null,2),e("span",ge,l(_.value),1)])])])]),t[9]||(t[9]=e("h5",{class:"mt-5"},[e("i",{class:"bi bi-chat"}),b(" 댓글")],-1)),u.value.length===0?(r(),i("div",we,"댓글이 없습니다.")):y("",!0),(r(!0),i(V,null,H(u.value,n=>(r(),i("div",{key:n.commentUID+"-"+O.value,class:"comment-item"},[e("div",ye,[e("div",_e,[e("div",ke,[e("b",null,l(S(n.username))+" "+l(n.username),1),e("small",xe,l(s.fmtDate(n.createdAt)),1)]),n.commentOwner?(r(),i("div",De,[e("button",{class:"btn btn-sm btn-link text-danger",onClick:a=>G(n)},"삭제",8,Ce)])):y("",!0)]),e("div",{class:"mt-1",innerHTML:A(n.content)},null,8,$e),g.value&&g.value[n.commentUID]?(r(),i("div",Ue,[(r(!0),i(V,null,H(g.value[n.commentUID],a=>(r(),i("div",{key:a.replyUID,class:"border-start ps-3 mb-2",style:{"font-size":"0.9rem"}},[e("strong",null,l(S(a.username))+l(a.username),1),e("small",Ie,l(s.fmtDate(a.createdAt)),1),e("div",null,l(a.content),1)]))),128))])):y("",!0),e("button",{class:"btn btn-sm btn-outline-primary mt-2",onClick:a=>Q(n.commentUID)},"답글 달기",8,Te),I(e("div",Me,[I(e("textarea",{"onUpdate:modelValue":a=>k.value[n.commentUID]=a,rows:"2",class:"form-control mb-2",placeholder:"답글 입력"},null,8,Oe),[[R,k.value[n.commentUID]]]),e("button",{class:"btn btn-sm btn-primary",onClick:a=>X(n.commentUID)},"답글 작성",8,Se)],512),[[re,x.value===n.commentUID]])])]))),128)),e("div",Le,[e("h6",Ne,[t[8]||(t[8]=e("span",null,[e("i",{class:"bi bi-pencil-square"}),b(" 댓글 쓰기")],-1)),w.value?y("",!0):(r(),i("button",{key:0,class:"btn btn-sm btn-outline-secondary",onClick:t[0]||(t[0]=n=>ie(v).push("/login"))},"로그인"))]),I(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=n=>f.value=n),rows:"3",class:"form-control mb-2",placeholder:w.value?"내용 입력":"로그인 후 이용"},null,8,Ve),[[R,f.value]]),e("button",{class:"btn btn-success",disabled:!w.value||C.value||!f.value.trim(),onClick:K}," 작성하기 ",8,He)])])):(r(),i("div",Re,t[10]||(t[10]=[e("i",{class:"bi bi-arrow-repeat fs-2 spin"},null,-1)])))}},je=ee(Be,[["__scopeId","data-v-bbbac1c4"]]);export{je as default};
