<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시판 목록</title>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">

    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        h1 {
            margin-bottom: 30px;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .btn-link {
            color: #007bff;
            text-decoration: none;
        }
        .btn-link:hover {
            text-decoration: underline;
        }
        .pagination {
            justify-content: center;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="row">
        <!-- 전체 게시글 목록 -->
        <div class="col-md-8">
            <h1 class="text-center">전체 게시글 목록</h1>
            <div class="mb-4">
                <!-- 게시글 리스트 -->
                <table class="table table-striped table-hover">
                    <thead>
                    <tr>
                        <th>번호</th>
                        <th>제목</th>
                        <th>작성자</th>
                        <th>카테고리</th>
                        <th>내용</th>
                        <th>좋아요 수</th>
                        <th>작성일자</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 게시글 리스트 출력 -->
                    <tr th:each="board : ${data}">
                        <td><a th:href="@{/search/view/feed/id(id=${board.id})}" th:text="${board.id}"></a></td>
                        <td th:text="${board.title}"></td>
                        <td th:text="${board.username}"></td>
                        <td th:text="${board.category}"></td>
                        <td th:text="${board.description}"></td>
                        <td th:text="${board.likeCount}"></td>
                        <td th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
                    </tr>
                    <!-- 게시글이 없을 경우 -->
                    <tr th:if="${#lists.isEmpty(data)}">
                        <td colspan="5" class="text-center">게시글이 없습니다.</td>
                    </tr>
                    </tbody>
                </table>

                <!-- 페이지네이션 -->
                <nav style="text-align: center;">
                    <ul class="pagination"
                        th:with="start=${(page != null && maxPage != null && maxPage > 0) ? ((page / maxPage) * maxPage + 1) : 0},
            end=${(start + maxPage - 1) < maxPage ? (start + maxPage - 1) : maxPage},
            totalPages=${(maxPage != null && maxPage > 0) ? maxPage : 1}">

                    <!-- 처음 페이지로 이동 -->
                        <li th:if="${page > 0}" class="page-item">
                            <a th:href="@{/search/view/feed(page=${page - 1})}" class="page-link" th:text="'<'"></a>
                        </li>
                        <li th:each="p : ${#numbers.sequence(start, end)}" class="page-item"
                            th:classappend="${p - 1 == page} ? 'active'">
                            <a th:href="@{/search/view/feed(page=${p - 1})}" class="page-link" th:text="${p}"></a>
                        </li>
                        <li th:if="${page + 1 < maxPage}" class="page-item">
                            <a th:href="@{/search/view/feed(page=${page + 1})}" class="page-link" th:text="'>'"></a>
                        </li>
                        <!-- 마지막 페이지로 이동 -->
                        <li th:if="${end < totalPages}" class="page-item">
                            <a th:href="@{/search/view/feed(page=${totalPages - 1})}" class="page-link" th:text="'>>'"></a>
                        </li>
                    </ul>
                </nav>

            </div>
            <form action="/search/view/feed/range" method="get" class="d-flex align-items-center" style="width: 50%; max-width: 350px;">
                <h6>날짜</h6>
                <div class="input-group">
                    <input type="datetime-local" id="startDate" name="startDate" class="form-control form-control-sm" required />
                    <input type="datetime-local" id="endDate" name="endDate" class="form-control form-control-sm" required />
                    <button type="submit" class="btn btn-primary btn-sm">
                        <i class="fas fa-search"></i> 검색
                    </button>
                </div>
            </form>

            <div class="d-flex justify-content-center">
                <h6>검색</h6>
                <form id="searchForm" method="get" class="mb-3" style="width: 50%; max-width: 500px;">
                    <div class="input-group d-flex">
                        <!-- 드롭다운 선택 -->
                        <select id="searchType" name="searchType" class="form-control form-control-sm"
                                style="width: 25%; margin-right: 5px;">
                            <option value="text">제목 + 내용</option>
                            <option value="category">카테고리</option>
                        </select>
                        <!-- 입력창 -->
                        <input type="text" id="searchInput" name="text" placeholder="검색어를 입력하세요"
                               class="form-control form-control-sm" style="width: 50%; margin-right: 5px;" required />
                        <!-- 버튼 -->
                        <button type="button" class="btn btn-primary btn-sm"
                                style="width: 15%; white-space: nowrap;" onclick="redirectSearch()">
                            <i class="fas fa-search"></i> 검색
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 이달의 게시글 -->
        <div class="col-md-3">
            <h3>이달의 게시글</h3>
            <div class="row">
                <div th:each="board : ${month}" class="col-12 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-body p-2">
                            <div class="d-flex justify-content-between">
                                <!-- 게시글 작성자와 제목 표시 -->
                                <h6 class="card-title text-truncate" th:text="${board.title}"></h6>
                                <small class="text-muted" th:text="${board.username}"></small>
                            </div>
                            <!-- 간단한 설명이나 추가 정보 -->
                            <p class="card-text text-truncate" th:text="${board.description}"></p>
                            <a th:href="@{/search/view/feed/id(id=${board.id})}" class="btn btn-outline-primary btn-sm">자세히 보기</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- 하단 버튼들 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="d-flex">
            <a th:href="@{'/search/view/feed/like'}" class="btn btn-link me-2">
                <i class="fas fa-thumbs-up"></i> 좋아요 수 ▼
            </a>
        </div>

        <!-- 작성하기 버튼 -->
        <form action="/search/view/feed/Form" method="get">
            <button type="submit" class="btn btn-secondary">
                <i class="fas fa-home"></i> 작성하기
            </button>
        </form>
    </div>

</div>

</body>

<!-- 중앙 정렬을 위한 div 추가 -->


<script>
    document.getElementById("searchButton").addEventListener("click", function() {
        console.log("검색 버튼 클릭됨");
    });
    function redirectSearch() {
        const form = document.getElementById('searchForm');
        const searchType = document.getElementById('searchType').value;
        const searchText = document.getElementById('searchInput').value;

        // searchType 값에 따라 form.action 설정
        if (searchType === "text") {
            form.action = '/search/view/feed/text';
        } else if (searchType === "category") {
            form.action = '/search/view/feed/category';
        }

        // searchText를 쿼리 파라미터로 추가 (searchType은 제외)
        if (searchText) {
            form.action += `?text=${encodeURIComponent(searchText)}`;
        }

        console.log('최종 form.action:', form.action);

        // 폼 제출
        form.submit();
    }
</script>

<!-- 메인으로 돌아가기 버튼 -->
<div class="text-center mt-4">
    <a href="/static" class="btn btn-secondary"><i class="fas fa-home"></i> 메인으로 돌아가기</a>

</div>


<!-- Bootstrap JS (Optional) -->
<script src="/webjars/bootstrap/js/bootstrap.bundle.min.js"></script>

</div>
</html>