<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë¬¸ì œì€í–‰ - ì‹¤ê¸° ì—°ë„/íšŒì°¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f9fafb, #edf1f5 70%);
            min-height: 100vh;
        }
        .year-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            border-radius: 1rem;
            overflow: hidden;
            cursor: pointer;
        }
        .year-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        .modal-header {
            background: #0d6efd;
            color: white;
        }
        .btn-close {
            filter: invert(1);
        }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="mb-4 text-center">
        <h2 class="fw-bold text-primary">ğŸ› ï¸ ì‹¤ê¸° ë¬¸ì œ - ì—°ë„/íšŒì°¨</h2>
        <p class="text-muted mb-0">ì›í•˜ëŠ” ì—°ë„ì™€ íšŒì°¨ë¥¼ ì„ íƒí•´ ë¬¸ì œë¥¼ í™•ì¸í•˜ì„¸ìš”!</p>
    </div>

    <!-- ì—°ë„ ë¦¬ìŠ¤íŠ¸ -->
    <div class="row row-cols-1 row-cols-md-4 g-4">
        <!-- 2024 -->
        <div class="col">
            <div class="card year-card text-center p-4" data-year="2024" data-bs-toggle="modal" data-bs-target="#sessionModal">
                <h3 class="fw-bold">2024</h3>
                <p class="text-secondary mb-0">ì‹¤ê¸° ë¬¸ì œ</p>
            </div>
        </div>
        <!-- 2023 -->
        <div class="col">
            <div class="card year-card text-center p-4" data-year="2023" data-bs-toggle="modal" data-bs-target="#sessionModal">
                <h3 class="fw-bold">2023</h3>
                <p class="text-secondary mb-0">ì‹¤ê¸° ë¬¸ì œ</p>
            </div>
        </div>
        <!-- 2022 -->
        <div class="col">
            <div class="card year-card text-center p-4" data-year="2022" data-bs-toggle="modal" data-bs-target="#sessionModal">
                <h3 class="fw-bold">2022</h3>
                <p class="text-secondary mb-0">ì‹¤ê¸° ë¬¸ì œ</p>
            </div>
        </div>
        <!-- 2021 -->
        <div class="col">
            <div class="card year-card text-center p-4" data-year="2021" data-bs-toggle="modal" data-bs-target="#sessionModal">
                <h3 class="fw-bold">2021</h3>
                <p class="text-secondary mb-0">ì‹¤ê¸° ë¬¸ì œ</p>
            </div>
        </div>
    </div>
</div>

<!-- ëª¨ë‹¬: íšŒì°¨ ì„ íƒ -->
<div class="modal fade" id="sessionModal" tabindex="-1" aria-labelledby="sessionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="sessionModalLabel">íšŒì°¨ ì„ íƒ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p id="selectedYear" class="mb-4 fw-bold fs-4 text-primary">ì—°ë„</p>
                <div class="d-grid gap-3">
                    <button class="btn btn-primary" onclick="loadQuestions(1)">1íšŒì°¨</button>
                    <button class="btn btn-primary" onclick="loadQuestions(2)">2íšŒì°¨</button>
                    <button class="btn btn-primary" onclick="loadQuestions(3)">3íšŒì°¨</button>
                    <!-- í•„ìš” ì‹œ 4íšŒì°¨, 5íšŒì°¨ ë“±ë„ ì¶”ê°€ ê°€ëŠ¥ -->
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let selectedYear = '';
    document.querySelectorAll('.year-card').forEach(card => {
        card.addEventListener('click', function () {
            selectedYear = this.getAttribute('data-year');
            document.getElementById('selectedYear').innerText = selectedYear + 'ë…„';
        });
    });
    function loadQuestions(sessionNum) {
        const params = new URLSearchParams(window.location.search);
        const category = params.get('category');  // ì˜ˆ: "ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ì‹¤ê¸°"
        const token = localStorage.getItem('token');

        if (!category || !token || !selectedYear) {
            alert("ì„ íƒ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            return;
        }

        const round = `${selectedYear}_${sessionNum}íšŒ`;
        const apiUrl = `/practical?category=${encodeURIComponent(category)}&round=${encodeURIComponent(round)}`;

        $.ajax({
            url: apiUrl,
            method: 'GET',
            headers: {
                Authorization: `Bearer ${token}`
            },
            success: function (res) {
                localStorage.setItem("questions", JSON.stringify(res.DTOS));
                localStorage.setItem("category", category);
                localStorage.setItem("round", round);
                console.log(category)
                window.location.href = "/search/view/practical/question";
            },
            error: function (err) {
                console.error('ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err);
                alert("ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }


</script>

</body>
</html>
