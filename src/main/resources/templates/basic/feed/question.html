<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë¬¸ì œì€í–‰ - ìê²©ì¦ ì„ íƒ & ì—°ë„/íšŒì°¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f2f6fc, #e3ecfa 70%);
            min-height: 100vh;
        }
        .cert-card, .year-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            border-radius: 1rem;
            overflow: hidden;
        }
        .cert-card:hover, .year-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        .cert-img {
            width: 60px;
            height: 60px;
            margin-bottom: 1rem;
        }
        .btn-close {
            outline: none;
        }
        /* ì²˜ìŒì—” year-section ìˆ¨ê¹€ */
        #yearSection {
            display: none;
        }
        .modal-body > button {
            font-size: 1.1rem;
            padding: 0.75rem 1rem;
        }
    </style>
</head>

<body>
<nav id="leftSidebar" class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold text-primary me-auto custom-logo" href="/">Ninfo</a>
    </div>
</nav>
<div class="container py-5">
    <div class="mb-4 text-center">
        <h2 class="fw-bold text-primary">ğŸ“˜ ë¬¸ì œì€í–‰</h2>
        <p class="text-muted mb-0">ìê²©ì¦ë³„ ì‹¤ê¸° ë° í•„ê¸° ë¬¸ì œ â†’ ì—°ë„ & íšŒì°¨ ì„ íƒ</p>
    </div>

    <!-- (1) ìê²©ì¦ & ì‹¤ê¸°/í•„ê¸° ì„ íƒ ì„¹ì…˜ -->
    <div id="certSection">
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <!-- ì˜ˆì‹œ: ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ -->
            <div class="col">
                <div class="card cert-card h-100 text-center p-3" data-certname="ì •ë³´ì²˜ë¦¬ê¸°ì‚¬" data-bs-toggle="modal" data-bs-target="#selectTypeModal">
                    <img src="https://img.icons8.com/office/80/book.png" class="mx-auto cert-img" alt="ìê²©ì¦ ì•„ì´ì½˜">
                    <h5 class="fw-bold mb-1">ì •ë³´ì²˜ë¦¬ê¸°ì‚¬</h5>
                    <p class="text-secondary small mb-0">í•„ê¸°/ì‹¤ê¸° ë¬¸ì œ</p>
                </div>
            </div>

            <!-- ì˜ˆì‹œ: ì •ë³´ë³´ì•ˆê¸°ì‚¬ -->
            <div class="col">
                <div class="card cert-card h-100 text-center p-3" data-certname="ì •ë³´ë³´ì•ˆê¸°ì‚¬" data-bs-toggle="modal" data-bs-target="#selectTypeModal">
                    <img src="https://img.icons8.com/office/80/security-checked.png" class="mx-auto cert-img" alt="ìê²©ì¦ ì•„ì´ì½˜">
                    <h5 class="fw-bold mb-1">ì •ë³´ë³´ì•ˆê¸°ì‚¬</h5>
                    <p class="text-secondary small mb-0">í•„ê¸°/ì‹¤ê¸° ë¬¸ì œ</p>
                </div>
            </div>
            <div class="col">
                <div class="card cert-card h-100 text-center p-3" data-certname="ì •ë³´ì²˜ë¦¬ê¸°ëŠ¥ì‚¬" data-bs-toggle="modal" data-bs-target="#selectTypeModal">
                    <img src="https://img.icons8.com/office/80/computer.png" class="mx-auto cert-img" alt="ìê²©ì¦ ì•„ì´ì½˜">
                    <h5 class="fw-bold mb-1">ì •ë³´ì²˜ë¦¬ê¸°ëŠ¥ì‚¬</h5>
                    <p class="text-secondary small mb-0">í•„ê¸°/ì‹¤ê¸° ë¬¸ì œ</p>
                </div>
            </div>

            <!-- SQLD -->
            <div class="col">
                <div class="card cert-card h-100 text-center p-3" data-certname="SQLD" data-bs-toggle="modal" data-bs-target="#selectTypeModal">
                    <img src="https://img.icons8.com/office/80/database.png" class="mx-auto cert-img" alt="ìê²©ì¦ ì•„ì´ì½˜">
                    <h5 class="fw-bold mb-1">SQLD</h5>
                    <p class="text-secondary small mb-0">í•„ê¸°/ì‹¤ê¸° ë¬¸ì œ</p>
                </div>
            </div>

            <!-- ë¹…ë¶„ê¸° -->
            <div class="col">
                <div class="card cert-card h-100 text-center p-3" data-certname="ë¹…ë¶„ê¸°" data-bs-toggle="modal" data-bs-target="#selectTypeModal">
                    <img src="https://img.icons8.com/office/80/analysis.png" class="mx-auto cert-img" alt="ìê²©ì¦ ì•„ì´ì½˜">
                    <h5 class="fw-bold mb-1">ë¹…ë¶„ê¸°</h5>
                    <p class="text-secondary small mb-0">í•„ê¸°/ì‹¤ê¸° ë¬¸ì œ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- (2) ì—°ë„ & íšŒì°¨ ì„ íƒ ì„¹ì…˜ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
    <div id="yearSection">
        <div class="text-center mb-4">
            <h3 class="fw-bold text-success">ğŸ› ï¸ <span id="selectedCategoryLabel"></span></h3>
            <p class="text-muted mb-0">ì›í•˜ëŠ” ì—°ë„ì™€ íšŒì°¨ë¥¼ ì„ íƒí•˜ì„¸ìš”!</p>
        </div>
        <div class="row row-cols-1 row-cols-md-4 g-4">
            <div class="col">
                <div class="card year-card text-center p-4" data-year="2024" data-bs-toggle="modal" data-bs-target="#sessionModal">
                    <h3 class="fw-bold">2024</h3>
                    <p class="text-secondary mb-0">ë¬¸ì œ ì„ íƒ</p>
                </div>
            </div>
            <div class="col">
                <div class="card year-card text-center p-4" data-year="2023" data-bs-toggle="modal" data-bs-target="#sessionModal">
                    <h3 class="fw-bold">2023</h3>
                    <p class="text-secondary mb-0">ë¬¸ì œ ì„ íƒ</p>
                </div>
            </div>
            <div class="col">
                <div class="card year-card text-center p-4" data-year="2022" data-bs-toggle="modal" data-bs-target="#sessionModal">
                    <h3 class="fw-bold">2022</h3>
                    <p class="text-secondary mb-0">ë¬¸ì œ ì„ íƒ</p>
                </div>
            </div>
            <div class="col">
                <div class="card year-card text-center p-4" data-year="2021" data-bs-toggle="modal" data-bs-target="#sessionModal">
                    <h3 class="fw-bold">2021</h3>
                    <p class="text-secondary mb-0">ë¬¸ì œ ì„ íƒ</p>
                </div>
            </div>
            <div class="col">
                <div class="card year-card text-center p-4" data-year="tag" data-bs-toggle="modal" data-bs-target="#tagModal">
                    <h3 class="fw-bold">ê³¼ëª©ë³„ ë¬¸ì œ</h3>
                    <p class="text-secondary mb-0">ë¬¸ì œ ì„ íƒ</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="tagModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content rounded-4 shadow-sm border-0">
            <div class="modal-header bg-gradient text-white rounded-top-4" style="background: linear-gradient(90deg, #4a90e2, #007aff);">
                <h5 class="modal-title fw-bold fs-4">ğŸ“˜ ê³¼ëª©ë³„ ë¬¸ì œ ì„ íƒ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body py-5 px-4">
                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3 justify-content-center">
                    <!-- íƒœê·¸ ë²„íŠ¼ë“¤ -->
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(1)">Cì–¸ì–´</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(2)">ë„¤íŠ¸ì›Œí¬</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(11)">ë°ì´í„°ë² ì´ìŠ¤</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(7)">ë””ìì¸íŒ¨í„´</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(6)">ë³´ì•ˆ</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(14)">ìƒì†</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(12)">ì†Œí”„íŠ¸ì›¨ì–´ ê³µí•™</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(8)">ìŠ¤íƒ</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(10)">ìš´ì˜ì²´ì œ</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(9)">ìë£Œêµ¬ì¡°</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(5)">ìë°”</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(13)">í…ŒìŠ¤íŠ¸ê¸°ë²•</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(3)">íŒŒì´ì¬</button>
                    <button class="btn btn-outline-primary rounded-pill px-4 py-2" onclick="loadTagQuestions(4)">í¬ì¸í„°</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="sessionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title fw-bold">íšŒì°¨ ì„ íƒ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <p id="selectedYear" class="mb-4 fw-bold fs-4 text-primary">ì—°ë„</p>
                <div class="d-grid gap-3">
                    <button class="btn btn-primary" onclick="loadQuestions(1)">1íšŒì°¨</button>
                    <button class="btn btn-primary" onclick="loadQuestions(2)">2íšŒì°¨</button>
                    <button class="btn btn-primary" onclick="loadQuestions(3)">3íšŒì°¨</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="selectTypeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow-lg">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title fw-bold">ìœ í˜• ì„ íƒ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center p-4">
                <p id="selectedCertName" class="mb-4 fw-bold fs-5 text-primary bg-light p-2 rounded">ìê²©ì¦ëª…</p>
                <button class="btn btn-primary w-100 mb-3 fs-5 py-2" onclick="chooseMode('í•„ê¸°')">ğŸ“˜ í•„ê¸° ë¬¸ì œ</button>
                <button class="btn btn-success w-100 fs-5 py-2" onclick="chooseMode('ì‹¤ê¸°')">ğŸ› ï¸ ì‹¤ê¸° ë¬¸ì œ</button>
            </div>
        </div>
    </div>
</div>

<script>
    let selectedCert = '';
    let combinedCategory = '';
    let selectedYear = '';

    document.querySelectorAll('.cert-card').forEach(card => {
        card.addEventListener('click', function() {
            selectedCert = this.getAttribute('data-certname');
            document.getElementById('selectedCertName').innerText = selectedCert;
        });
    });

    function chooseMode(mode) {
        combinedCategory = `${selectedCert} ${mode}`; // ì˜ˆ: 'ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ì‹¤ê¸°'
        const token = localStorage.getItem('token');
        if (!token) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            return;
        }

        // ëª¨ë‹¬ ë‹«ê³  ìê²©ì¦ ì„¹ì…˜ ìˆ¨ê¸°ê³  â†’ ì—°ë„ ì„¹ì…˜ ë³´ì—¬ì¤Œ
        const modal = bootstrap.Modal.getInstance(document.getElementById('selectTypeModal'));
        modal.hide();

        document.getElementById('certSection').style.display = 'none';
        document.getElementById('yearSection').style.display = 'block';

        document.getElementById('selectedCategoryLabel').innerText = combinedCategory;
    }

    document.querySelectorAll('.year-card').forEach(card => {
        card.addEventListener('click', function () {
            selectedYear = this.getAttribute('data-year');

            if (selectedYear === 'random') {
                loadRandomQuestions();
                return;
            }

            if (selectedYear === 'tag') {
                return;
            }

            document.getElementById('selectedYear').innerText = selectedYear + 'ë…„';
            const modal = new bootstrap.Modal(document.getElementById('sessionModal'));
            modal.show();
        });
    });



    function loadQuestions(sessionNum) {
        const token = localStorage.getItem('token');
        if (!token || !combinedCategory || !selectedYear) {
            alert("í•„ìˆ˜ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.");
            return;
        }

        const category = combinedCategory;
        const round = `${selectedYear}_${sessionNum}íšŒ`;
        const apiUrl = `/practical?category=${encodeURIComponent(category)}&round=${encodeURIComponent(round)}`;

        $.ajax({
            url: apiUrl,
            method: 'GET',
            headers: {
                Authorization: `Bearer ${token}`
            },
            success: function (res) {
                localStorage.setItem("questions", JSON.stringify(res.DTOS));
                localStorage.setItem("category", category);
                localStorage.setItem("round", round);

                // ë¬¸ì œ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = "/search/view/practical/question";
            },
            error: function (err) {
                console.error('ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err);
                alert("ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }
    function loadRandomQuestions() {
        const token = localStorage.getItem('token');
        if (!token || !combinedCategory) {
            alert("ë¡œê·¸ì¸ ë˜ëŠ” ì¹´í…Œê³ ë¦¬ ì„ íƒì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
        }

        $.ajax({
            url: "/practical/random",
            method: "GET",
            headers: {
                Authorization: `Bearer ${token}`
            },
            success: function (res) {
                localStorage.setItem("questions", JSON.stringify(res.DTOS));
                localStorage.setItem("category", combinedCategory);
                localStorage.setItem("round", "ëœë¤");

                window.location.href = "/search/view/practical/question";
            },
            error: function (err) {
                console.error('ëœë¤ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err);
                alert("ëœë¤ ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }
    function loadTagQuestions(tagId) {
        const token = localStorage.getItem("token");
        if (!token) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
        }

        document.getElementById("selectedYear").style.display = "none";

        $.ajax({
            url: `/practical/tag?tagId=${tagId}`,
            method: "GET",
            headers: {
                Authorization: `Bearer ${token}`
            },
            success: function (res) {
                localStorage.setItem("questions", JSON.stringify(res.DTOS));
                localStorage.setItem("category", `tag_${tagId}`);
                localStorage.setItem("round", "íƒœê·¸ ë¬¸ì œ");

                window.location.href = "/search/view/practical/question";
            },
            error: function (err) {
                console.error("íƒœê·¸ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                alert("ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            }
        });
    }



</script>
</body>
</html>
