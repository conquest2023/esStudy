<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>자격증 캘린더</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #f8f9fa;
    }
    .container {
      max-width: 1200px;
      margin: 30px auto;
    }
    .category-list {
      display: flex;
      justify-content: space-around;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .category-item {
      padding: 10px 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    .category-item:hover, .category-item.active {
      background: #007bff;
      color: white;
    }
    #calendar {
      margin-top: 20px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .category-title {
      font-size: 18px;
      font-weight: bold;
      padding-bottom: 10px;
      border-bottom: 2px solid #007bff;
      margin-bottom: 15px;
    }
    .category-list {
      padding: 10px;
      list-style: none;
    }
    .category-item {
      padding: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    .category-item:hover, .category-item.active {
      background: #007bff;
      color: white;
    }
    .sub-category {
      list-style: none;
      padding-left: 15px;
    }
    .sub-category-item {
      padding: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    .sub-category-item:hover {
      background: #007bff;
      color: white;
      border-radius: 5px;
    }

    @media (max-width: 768px) {
      #calendar {
        height: 500px !important;
      }
    }
    @media (min-width: 769px) {
      #calendar {
        height: 800px !important;
      }
    }

    /* ✅ 주말 스타일 (CSS로 강제 적용) */
    .fc-day-sat a {
      color: #3498db !important;
    }
    .fc-day-sun a {
      color: #e74c3c !important;
    }
    /* ✅ 공휴일 스타일 */
    .fc-holiday {
      background-color: #ff4757 !important;
      color: white !important;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 class="text-center text-primary">📅 자격증 일정 캘린더</h1>

  <div class="category-list">
    <div class="category-item active" data-category="all">전체 보기</div>
    <div class="category-item" data-category="national">국가 자격증</div>
    <div class="category-item" data-category="private">민간 자격증</div>
    <div class="category-item" data-category="language">어학 자격증</div>
  </div>

  <div id="calendar"></div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var calendarEl = document.getElementById("calendar");

    // ✅ 대한민국 공휴일 (2024년 기준)
    var holidays = [
      { title: "신정", start: "2024-01-01" },
      { title: "설날", start: "2024-02-09", end: "2024-02-11" },
      { title: "삼일절", start: "2024-03-01" },
      { title: "어린이날", start: "2024-05-05" },
      { title: "현충일", start: "2024-06-06" },
      { title: "광복절", start: "2024-08-15" },
      { title: "추석", start: "2024-09-16", end: "2024-09-18" },
      { title: "개천절", start: "2024-10-03" },
      { title: "한글날", start: "2024-10-09" },
      { title: "성탄절", start: "2024-12-25" }
    ];

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "dayGridMonth",
      locale: "ko",
      headerToolbar: {
        left: "prev,next today",
        center: "title",
        right: "dayGridMonth,timeGridWeek,timeGridDay"
      },
      eventLimit: true,
      dayMaxEventRows: 3,
      moreLinkText: "더보기",
      height: "auto",
      events: [].concat(holidays.map(h => ({
        ...h,
        classNames: ["fc-holiday"]

      }))),

      eventDidMount: function (info) {
        if (info.event.extendedProps.classNames && info.event.extendedProps.classNames.includes("fc-holiday")) {
          info.el.style.backgroundColor = "#ff4757";
          info.el.style.color = "#ffffff";
        } else {
          info.el.style.backgroundColor = info.event.extendedProps.backgroundColor;
        }
      }
    });
    calendar.render();

    document.querySelectorAll(".category-item").forEach(item => {
      item.addEventListener("click", function () {
        document.querySelectorAll(".category-item").forEach(el => el.classList.remove("active"));
        this.classList.add("active");

        var selectedCategory = this.getAttribute("data-category");
        calendar.getEvents().forEach(event => {
          if (selectedCategory === "all" || event.extendedProps.category === selectedCategory) {
            event.setProp("display", "auto");
          } else {
            event.setProp("display", "none");
          }
        });
      });
    });


      function fetchCertificationSchedules() {
        const token = localStorage.getItem("token");

            fetch("/certificate/schedule", {
              method: "GET",
              headers: {
                "Authorization": "Bearer " + token }}
            )
                .then(response => response.json())
                .then(data => {
                  console.log(data)
                  if (data.certSchedule) {
                    const uniqueEvents = new Map();
                    const events = data.certSchedule.flatMap(cert => [
                      { title: `[필기 원서접수] ${cert.name} - ${cert.examRound}`, start: cert.writtenRegStart, color: "#007bff" },
                      { title: `[필기 시험] ${cert.name} - ${cert.examRound}`, start: cert.writtenExamStart, color: "#ff6b6b" },
                      { title: `[필기 합격발표] ${cert.name} - ${cert.examRound}`, start: cert.writtenPassDate, color: "#ffc107" },
                      { title: `[실기 원서접수] ${cert.name} - ${cert.examRound}`, start: cert.practicalRegStart, color: "#17a2b8" },
                      { title: `[실기 시험] ${cert.name} - ${cert.examRound}`, start: cert.practicalExamStart, color: "#28a745" },
                      { title: `[실기 합격발표] ${cert.name} - ${cert.examRound}`, start: cert.practicalPassStart, color: "#ff851b" }
                    ]);

                    calendar.addEventSource(events);
                    calendar.render();
                  }
                })
                  .catch(error => console.error("데이터 로딩 오류:", error));
      }

    fetchCertificationSchedules();
  });

</script>

</body>
</html>
